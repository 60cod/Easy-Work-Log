**개요**  
매일 정해진 시각에 자동으로 실행되어 업무 일지 템플릿 페이지를 띄우고, 사용자가 클릭한 후 로컬 LLM으로 내용을 가공하여 구글 드라이브에 문서로 저장한 뒤 종료하는 윈도우 환경용 자동 업무 일지 작성 애플리케이션의 설계 문서입니다.

---

## 1. 목적  
- 매일 동일한 반복 작업(업무일지 작성 → 가공 → 저장 → 종료) 자동화  
- 최소한의 사용자 입력(클릭 한 번)으로 전문적인 일지 생성  
- 추가 비용 없이 개인 PC 리소스를 과도하게 사용하지 않는 경량 솔루션

---

## 2. 요구 사항

### 2.1 기능적 요구 사항  
1. **자동 실행**  
   - 매일 17:00에 가상환경(venv) 활성화 후 애플리케이션 실행  
2. **템플릿 페이지 오픈**  
   - 로컬 웹 서버(Flask 또는 간단한 HTTP 서버)로 업무일지 템플릿 페이지 표시  
3. **사용자 인터랙션**  
   - “작성” 버튼 클릭 시 다음 단계로 진행  
4. **LLM 호출 및 가공**  
   - EXAONE-3.5-2.4B-Instruct 등 실제 적용 가능한 한국어 최적화 로컬 LLM(예: Llama.cpp 기반)에게 원본 템플릿 전달  
   - “프로페셔널” 스타일로 문장 재구성  
5. **문서 생성 및 저장**  
   - Google Drive API를 통해 지정 경로에 Google Docs 파일 생성  
   - LLM이 반환한 내용을 문서 본문으로 삽입  
6. **종료**  
   - 18:00에 앱 종료 및 가상환경 비활성화

### 2.2 비기능적 요구 사항  
- **성능**: 가공 및 문서 작성 시간 전체 5분 이내  
- **안정성**: 오류 발생 시 로그 출력 및 재시도 로직  
- **경량화**: 로컬 LLM 모델 메모리 사용량 ≤ 4 GB  
- **보안**: Drive API 인증 정보 로컬 안전 저장(토큰 암호화)

---

## 3. 시스템 아키텍처  

```
┌───────────────┐      ┌───────────┐      ┌──────────────┐
│ Windows Task  │─(1)─>│ Python App│─(2)─>│ Flask Server │
│ Scheduler     │      │(venv)     │      │ (템플릿)     │
└───────────────┘      └───────────┘      └──────┬───────┘
                                                   │ (3)
                                                   v
                                           ┌────────────────┐
                                           │ Local LLM      │
                                           └────────────────┘
                                                   │ (4)
                                                   v
                                           ┌────────────────┐
                                           │ Google Drive   │
                                           │ API            │
                                           └────────────────┘
                                                   │ (5)
                                                   v
                                           ┌────────────────┐
                                           │ 종료 및 로그   │
                                           └────────────────┘
```

---

## 4. 구성 요소

| 구성 요소             | 설명                                                               |
|----------------------|------------------------------------------------------------------|
| Windows Task Scheduler | 매일 17:00/18:00 트리거 관리                                       |
| Python 실행 스크립트     | 가상환경 활성화, Flask 서버 기동, 종료 타이머 설정                   |
| Flask Server         | 업무일지 템플릿 HTML/CSS/JS 페이지 제공, 버튼 클릭 이벤트 처리        |
| 로컬 LLM 인터페이스     | llama.cpp CLI 또는 Python 바인딩을 통한 프롬프트 전송·응답 수신        |
| Google Drive 모듈      | `google-auth`, `google-api-python-client` 활용 문서 생성·편집 로직    |
| 로깅 및 에러 핸들러     | 파일단위 로그, 예외 발생 시 재시도 또는 관리자 알림(콘솔 출력 등)      |

---

## 5. 상세 동작 흐름

1. **17:00 – 실행 트리거**  
   - Task Scheduler:  
     ```powershell
     cmd.exe /c "C:\path\to\activate_venv.bat && python app.py"
     ```
2. **앱 초기화 (app.py)**  
   - 로그 초기화  
   - 백그라운드 스레드로 종료 타이머 설정 (18:00)  
   - Flask 서버 실행 (localhost:5959)
3. **템플릿 페이지 표시**  
   - `templates/log_template.html` 로딩  
   - “작성” 버튼 대기
4. **작성 버튼 클릭**  
   - AJAX 요청: `/generate` 엔드포인트 호출
5. **LLM 처리**  
   - 사용자 입력 + 기본 템플릿 → 프롬프트 파일 생성  
   - `subprocess.run(["llama_cpp", "-m", "model.bin", "-p", prompt.txt, "-o", output.txt])`  
   - 응답 파싱 후 JSON 형태로 반환
6. **Google Docs 생성**  
   - OAuth2 인증(토큰 재사용)  
   - Drive API: `files().create(media_body=..., body={'name': '업무일지_YYYYMMDD', 'mimeType': 'application/vnd.google-apps.document', 'parents': [folder_id]})`  
   - Docs API: `documents().batchUpdate(documentId=..., body={requests:[...]})`
7. **응답 화면 표시**  
   - 성공/실패 메시지 반환
8. **18:00 – 자동 종료**  
   - Flask 서버 종료, 가상환경 비활성화

---

## 6. 기술 스택

- **언어**: Python 3.10+  
- **웹 프레임워크**: Flask (경량)  
- **LLM 구동**: llama.cpp 또는 Ollama, Python 바인딩  
- **Google API**: `google-auth`, `google-api-python-client`  
- **스케줄링**: Windows Task Scheduler  
- **가상환경**: venv  
- **로깅**: Python `logging` 모듈 (파일·콘솔 동시 출력)  

---

## 7. 구현 일정 및 마일스톤

| 단계               | 기간         | 주요 작업                                           |
|------------------|------------|---------------------------------------------------|
| 1. 환경 준비        | 1일          | venv 생성, Flask·Google API·llama.cpp 설치             |
| 2. 템플릿 페이지 개발 | 1일          | HTML/CSS, 버튼 이벤트, Flask 라우팅 구현               |
| 3. LLM 연동        | 1~2일        | 로컬 모델 테스트, 프롬프트–응답 파이프라인 완성          |
| 4. Google Drive 연동 | 1~2일        | OAuth2, Docs/Drive API 기능 구현 및 테스트             |
| 5. 스케줄러 설정    | 반나절        | Task Scheduler 작업 정의 스크립트 작성 및 검증          |
| 6. 통합 테스트      | 1일          | 전체 플로우 테스트, 예외·에러 핸들링 보완               |
| 7. 배포 및 문서화    | 반나절        | 사용자 가이드, 설치 스크립트, 코드 정리                 |

---

## 8. 고려 사항

- **인증 토큰 관리**: 초기 인증 후 `token.json` 파일에 저장, 권한 만료 시 자동 갱신  
- **오프라인 상황**: LLM 또는 Drive API 오류 발생 시 사용자 알림 및 재시도 옵션 제시  
- **리소스 사용량**: LLM 배치 크기·스레드 수 제한으로 메모리 최적화  
- **보안**: Drive API 자격증명 파일(`credentials.json`)을 안전한 디렉터리에 보관  
- **확장성**: 향후 다국어 지원, Slack/Mail 알림 연동 고려  

---

## 9. 유지보수 및 확장 제언

- **모델 교체**: 모델 파일 경로 및 파라미터를 설정 파일(`config.yaml`)로 분리  
- **템플릿 추가**: 업무유형별 템플릿을 다중 선택하도록 UI 확장  
- **알림 기능**: 작성 완료 후 Slack/Webhook 알림 전송 모듈 추가  
- **로그 집계**: ELK 스택 또는 간단한 SQLite DB에 기록  
- **단위 테스트**: 주요 모듈별 pytest 테스트 케이스 작성  
- **업무 시간 기록**: 일별/월별 업무 시간 자동 집계 및 시각화  
- **그래프 제공**: 업무 시간, 성과 등 주요 지표에 대한 그래프 제공  
- **월별 업무 성과 요약**: 월 단위 업무 성과 자동 요약 리포트 생성  
